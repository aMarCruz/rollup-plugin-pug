{"version":3,"file":null,"sources":["../src/filter.js","../src/assign.js","../src/index.js"],"sourcesContent":["import { createFilter } from 'rollup-pluginutils'\nimport { extname } from 'path'\n\n/**\n * Creates a filter for the options `include`, `exclude`, and `extensions`.\n * It filter out names starting with `\\0`.\n * Since `extensions` is not a rollup option, I think is widely used.\n *\n * @param {object}       opts - The user options\n * @param {array|string} exts - Default extensions\n * @returns {function}   Filter function that returns true if a given\n *                       file matches the filter.\n */\nexport default function makeFilter (opts, exts) {\n  if (!opts) opts = {}\n\n  const filt = createFilter(opts.include, opts.exclude)\n\n  exts = opts.extensions || exts || '*'\n  if (exts !== '*') {\n    if (!Array.isArray(exts)) exts = [exts]\n    exts = exts.map((e) => { return e[0] !== '.' ? `.${e}` : e })\n  }\n\n  return function (id) {\n    return filt(id) && (exts === '*' || exts.indexOf(extname(id)) > -1)\n  }\n}\n","/**\n * Object.assign like function, but converts falsy `dest` to object.\n *\n * @param   {any} dest - An object or falsy value\n * @returns {Object}   object with merged properties\n */\nexport default function assign (dest) {\n  const args = arguments\n\n  dest = dest && Object(dest) || {}\n\n  for (let i = 1; i < args.length; i++) {\n    const src = args[i]\n\n    if (src) {\n      const keys = Object.keys(Object(src))\n\n      for (let j = 0; j < keys.length; j++) {\n        const p = keys[j]\n\n        dest[p] = src[p]\n      }\n    }\n  }\n\n  return dest\n}\n","\n/* eslint no-console:0 */\n\nimport { compile, compileClientWithDependenciesTracked } from 'pug'\nimport { resolve } from 'path'\nimport makeFilter from './filter'\nimport assign from './assign'\n\n// used pug options, note this list does not include 'name'\nconst PUGPROPS = [\n  'filename', 'basedir', 'doctype', 'pretty', 'filters', 'self',\n  'debug', 'compileDebug', 'globals', 'inlineRuntimeFunctions'\n]\n\n// perform a deep cloning of an object\nfunction clone (obj) {\n  if (obj == null || typeof obj != 'object') return obj\n  const copy = obj.constructor()\n  for (const attr in obj) {\n    if (obj.hasOwnProperty(attr)) copy[attr] = clone(obj[attr])\n  }\n  return copy\n}\n\n// deep copy of the properties filtered by list\nfunction cloneProps (src, list) {\n  return list.reduce((o, p) => {\n    if (p in src) o[p] = clone(src[p])\n    return o\n  }, {})\n}\n\n// rollup-plugin-pug --------------------------------------\n\nexport default function pugPlugin (options) {\n  if (!options) options = {}\n\n  // prepare extensions to match with the extname() result\n  const filter = makeFilter(options, ['.pug', '.jade'])\n\n  // shallow copy options & drop properties unused props\n  const config = assign({\n    doctype: 'html',\n    basedir: process.cwd(),\n    compileDebug: false,\n    locals: {}\n  }, options)\n\n  config.inlineRuntimeFunctions = false\n\n  if (!config.preCompile) {\n    config.pugRuntime = resolve(__dirname, './runtime.es.js')\n  }\n\n  return {\n\n    name: 'rollup-plugin-pug',\n\n    resolveId (importee, importer) {\n      console.log(`Ã¬mportee: ${importee}, importer: ${importer}`) //eslint-disable-line\n      if (/\\0pug-runtime$/.test(importee)) return config.pugRuntime\n    },\n\n    transform (code, id) {\n      if (!filter(id)) {\n        return null\n      }\n\n      const opts   = cloneProps(config, PUGPROPS)\n      const output = []\n      let fn, body\n\n      opts.filename = id\n\n      if (opts.preCompile) {\n        fn = compile(code, opts)\n        body = JSON.stringify(fn(opts.locals))\n      } else {\n        fn = compileClientWithDependenciesTracked(code, opts)\n        body = fn.body\n\n        if (~body.indexOf('pug.')) {\n          output.push('import pug from \"\\0pug-runtime\";')\n        }\n      }\n\n      const deps = fn.dependencies\n      if (deps.length > 1) {\n        const ins = {}\n        deps.forEach((dep) => {\n          if (dep in ins) return\n          ins[dep] = 1\n          output.push(`import \"${dep}\";`)\n        })\n      }\n\n      output.push(`export default ${body}`)\n\n      return output.join('\\n') + '\\n'\n    }\n\n  }\n}\n"],"names":["const","createFilter","extname","let","resolve","compile","compileClientWithDependenciesTracked"],"mappings":"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"}